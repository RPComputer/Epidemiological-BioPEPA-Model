#include "ProblemDefinition.h"

Vector Initialize()
{
    Vector x0(28, 0.0);

   x0(4) = 1;
   x0(5) = 4.64567e+06;
   x0(6) = 1324;
   x0(7) = 80;
   x0(8) = 16;
   x0(9) = 3413;
   x0(10) = 29;
   x0(11) = 584;
   x0(12) = 1;
   x0(13) = 22;
   x0(15) = 171440;
   x0(16) = 9150;
   x0(17) = 2280;
   x0(18) = 6;
   x0(19) = 596;
   x0(20) = 0;
   x0(21) = 13;
   x0(22) = 3;
   x0(23) = 3;
   x0(24) = 7;
   x0(26) = 260;
	return x0;
} 

Matrix Stoichiometry()
{
    Matrix nu(28, 61, 0.0);

   nu(0,0) = -1;
   nu(1,0) = -1;
   nu(2,0) = 1;

   nu(0,1) = 1;
   nu(1,1) = 1;
   nu(2,1) = -1;

   nu(0,2) = -1;
   nu(3,2) = -1;
   nu(4,2) = 1;

   nu(0,3) = 1;
   nu(3,3) = 1;
   nu(4,3) = -1;

   nu(0,4) = -1;
   nu(5,4) = -1;
   nu(6,4) = 1;

   nu(0,5) = 1;
   nu(5,5) = 1;
   nu(6,5) = -1;

   nu(3,6) = -1;
   nu(13,6) = -1;
   nu(14,6) = 1;

   nu(3,7) = 1;
   nu(13,7) = 1;
   nu(14,7) = -1;

   nu(13,8) = -1;
   nu(15,8) = -1;
   nu(16,8) = 1;

   nu(13,9) = 1;
   nu(15,9) = 1;
   nu(16,9) = -1;

   nu(2,10) = -1;
   nu(5,10) = -1;
   nu(7,10) = 1;

   nu(2,11) = 1;
   nu(5,11) = 1;
   nu(7,11) = -1;

   nu(4,12) = -1;
   nu(5,12) = -1;
   nu(8,12) = 1;

   nu(4,13) = 1;
   nu(5,13) = 1;
   nu(8,13) = -1;

   nu(2,14) = -1;
   nu(9,14) = -1;
   nu(11,14) = 1;

   nu(2,15) = 1;
   nu(9,15) = 1;
   nu(11,15) = -1;

   nu(4,16) = -1;
   nu(10,16) = -1;
   nu(12,16) = 1;

   nu(4,17) = 1;
   nu(10,17) = 1;
   nu(12,17) = -1;

   nu(14,18) = -1;
   nu(17,18) = -1;
   nu(18,18) = 1;

   nu(14,19) = 1;
   nu(17,19) = 1;
   nu(18,19) = -1;

   nu(21,20) = 1;

   nu(21,21) = -1;

   nu(13,22) = 1;

   nu(13,23) = -1;

   nu(15,24) = 1;
   nu(16,24) = -1;

   nu(3,25) = 1;
   nu(14,25) = -1;

   nu(3,26) = 1;
   nu(17,26) = 1;
   nu(18,26) = -1;

   nu(3,27) = 1;
   nu(26,27) = 1;
   nu(27,27) = -1;

   nu(22,28) = 1;

   nu(22,29) = -1;

   nu(17,30) = 1;

   nu(17,31) = -1;

   nu(14,32) = 1;
   nu(18,32) = -1;

   nu(24,33) = 1;

   nu(24,34) = -1;

   nu(3,35) = 1;

   nu(3,36) = -1;

   nu(13,37) = 1;
   nu(17,37) = 1;
   nu(18,37) = -1;

   nu(19,38) = 1;
   nu(20,38) = -1;

   nu(13,39) = 1;
   nu(26,39) = 1;
   nu(27,39) = -1;

   nu(23,40) = 1;

   nu(23,41) = -1;

   nu(19,42) = 1;

   nu(19,43) = -1;

   nu(3,44) = 1;
   nu(20,44) = -1;

   nu(3,45) = -1;
   nu(19,45) = -1;
   nu(20,45) = 1;

   nu(3,46) = 1;
   nu(19,46) = 1;
   nu(20,46) = -1;

   nu(25,47) = 1;

   nu(25,48) = -1;

   nu(26,49) = 1;

   nu(26,50) = -1;

   nu(14,51) = 1;
   nu(27,51) = -1;

   nu(14,52) = -1;
   nu(26,52) = -1;
   nu(27,52) = 1;

   nu(14,53) = 1;
   nu(26,53) = 1;
   nu(27,53) = -1;

   nu(0,54) = 1;
   nu(4,54) = -1;

   nu(0,55) = 1;
   nu(10,55) = 1;
   nu(12,55) = -1;

   nu(6,56) = 1;
   nu(8,56) = -1;

   nu(13,57) = 1;
   nu(14,57) = -1;

   nu(13,58) = 1;
   nu(17,58) = 1;
   nu(18,58) = -1;

   nu(13,59) = 1;
   nu(26,59) = 1;
   nu(27,59) = -1;

   nu(19,60) = 1;
   nu(20,60) = -1;

   return nu;
}

Vector Propensity(const Vector& x)
{
   double
   C1=2.54,
   C2=1,
   C3=0.254,
   C4=1,
   C9=0.000254,
   C10=0.01,
   C11=0.000254,
   C12=1,
   C13=0.000254,
   C14=1,
   C19=0.0254,
   C20=1,
   C21=6.62,
   C22=0.5,
   C23=20,
   C24=0.03,
   C25=0.03,
   C26=0.03,
   C27=0.03,
   C28=0.03,
   C29=1.67,
   C30=0.5,
   C31=20,
   C32=0.03,
   C33=0.03,
   C34=0.00625,
   C35=0.5,
   C36=7,
   C37=0.03,
   C38=3,
   C39=0.7,
   C40=0.5,
   C41=1,
   C42=0.5,
   C43=20,
   C44=0.03,
   C45=0.03,
   C48=0.43333,
   C49=0.5,
   C50=20,
   C51=0.03,
   C52=0.03,
   C55=0.03,
   C56=0.03,
   C57=0.03,
   C58=0.03,
   C59=0.03,
   C60=0.03,
   C61=0.03;

   Vector a(61);
   a(0) = C1*x(0)*x(1);
   a(1) = C2*x(2);
   a(2) = C3*x(0)*x(3);
   a(3) = C4*x(4);
   a(4) = 0;
   a(5) = 0;
   a(6) = 0;
   a(7) = 0;
   a(8) = C9*x(13)*x(15);
   a(9) = C10*x(16);
   a(10) = C11*x(2)*x(5);
   a(11) = C12*x(7);
   a(12) = C13*x(4)*x(5);
   a(13) = C14*x(8);
   a(14) = 0;
   a(15) = 0;
   a(16) = 0;
   a(17) = 0;
   a(18) = C19*x(14)*x(17);
   a(19) = C20*x(18);
   a(20) = C21;
   a(21) = C22*x(21);
   a(22) = C23;
   a(23) = C24*x(13);
   a(24) = C25*x(16);
   a(25) = C26*x(14);
   a(26) = C27*x(18);
   a(27) = C28*x(27);
   a(28) = C29;
   a(29) = C30*x(22);
   a(30) = C31;
   a(31) = C32*x(17);
   a(32) = C33*x(18);
   a(33) = C34;
   a(34) = C35*x(24);
   a(35) = C36;
   a(36) = C37*x(3);
   a(37) = C38*x(18);
   a(38) = C39*x(20);
   a(39) = C40*x(27);
   a(40) = C41;
   a(41) = C42*x(23);
   a(42) = C43;
   a(43) = C44*x(19);
   a(44) = C45*x(20);
   a(45) = 0;
   a(46) = 0;
   a(47) = C48;
   a(48) = C49*x(25);
   a(49) = C50;
   a(50) = C51*x(26);
   a(51) = C52*x(27);
   a(52) = 0;
   a(53) = 0;
   a(54) = C55*x(4);
   a(55) = C56*x(12);
   a(56) = C57*x(8);
   a(57) = C58*x(14);
   a(58) = C59*x(18);
   a(59) = C60*x(27);
   a(60) = C61*x(20);
   return a;
}


double solve1(double b, double c)
{
    return 0.5*(b - sqrt(b*b - 4*c));
}
	
void solve2(Vector& x)
{
   const double K1 = 10000./2.54, K2= 10000./254., K3 = 10000./2.54;
   double c1, c2, c3, c4, y, z, km1, km3, km;

//based on many assumptions

   c1 = x(19) + x(20);
   c2 = x(13) + x(14) + x(27);
   c3 = x(26) + x(27);
   c4 = x(3) + x(20) + x(14) + x(27);

   if (c2 < 0) {
      c2 = 0;
      x(13) = x(14) = x(27) = 0;
   }
   if (c4 < 0)
   {
      c4 = 0;
      x(3) = x(14) = x(20) = x(27) = 0;
   }
                                                                                                              
   km1 = K1/(x(19) + K1);
   km3 = K3/(x(26) + K3);
   km = K2*km3/km1;
                              
   z = solve1( c2 + c4 + km, c2*c4);
   y = c4 - z;

   x(3) = km1*y;
   x(20) = y - x(3);
   x(19) = c1 - x(20);
   x(13) = c2 - z;
   x(14) = km3*z;
   x(27) = z - x(14);
   x(26) = c3 - x(27);
}

void Equilibrium(Vector& x, Vector& a, int rxn)
{
   const double k1 = 10/0.0254, k2 = 1./2.54, k3 = 1./2.54;

   double xt1 = x(0) + x(6);
   double xt2 = x(5) + x(6);

   solve2(x);
   // assuming x(5) >> x(6)
   x(0) = k1*xt1/(k1+x(5));
   x(6) = xt1 - x(0);
   x(5) = xt2 - x(6);

   xt1 = x(2) + x(11);
   xt2 = x(9) + x(11);
  // assuming x(9) >> x(2)
   x(2) = k2*xt1/(k2 + x(9));
   x(11) = xt1 - x(2);
   x(9) = xt2 - x(11);

   xt1 = x(4) + x(12);
   xt2 = x(10) + x(12);
// assuming x(10) >> x(4)
   x(4) = k3*xt1/(k3 + x(10));
   x(12) = xt1 - x(4);
   x(10) = xt2 - x(12);
}

